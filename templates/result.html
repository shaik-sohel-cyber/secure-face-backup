<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Processing — Selective Face Blur</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0c10; --card:#12141a; --text:#e8edf2; --muted:#94a3b8; --accent:#3b82f6; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:var(--bg); color:var(--text); }
    .wrap{ max-width:820px; margin:48px auto; padding:0 16px; }
    h1{ margin:0 0 14px; }
    .card{ background:var(--card); border:1px solid #1e2330; border-radius:14px; padding:22px; }
    .muted{ color:var(--muted); }
    .bar-wrap{ margin-top:12px; width:100%; height:14px; border-radius:10px; background:#0f1117; border:1px solid #22283a; overflow:hidden; }
    .bar{ height:100%; width:0%; background:var(--accent); transition:width .25s ease; }
    .actions{ display:flex; gap:12px; margin-top:18px; }
    a.btn{ background:var(--accent); color:#fff; text-decoration:none; padding:10px 14px; border-radius:10px; font-weight:600; }
    a.btn:hover{ filter:brightness(1.05); }
    .err{ color:#ff7171; margin-top:10px; }
    .note{ margin-top:14px; font-size:13px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Processing your video…</h1>
    <div class="card">
      <div class="muted" id="status">Queued</div>
      <div class="bar-wrap"><div class="bar" id="bar"></div></div>

      <div class="actions" id="done" style="display:none;">
        <a class="btn" id="download" href="#">Download Output</a>
        <a class="btn" href="/">Process Another</a>
      </div>

      <div id="error" class="err"></div>
      <div class="note">This page will refresh progress automatically every 0.5s.</div>
    </div>
  </div>

  <script>
    const jobId = "{{ job_id }}";
    const filename = "{{ filename }}";

    const bar = document.getElementById('bar');
    const statusEl = document.getElementById('status');
    const done = document.getElementById('done');
    const dl = document.getElementById('download');
    const err = document.getElementById('error');

    async function poll() {
      try {
        const res = await fetch(`/progress/${jobId}`);
        const j = await res.json();

        if (typeof j.progress === 'number') {
          bar.style.width = Math.min(100, Math.max(0, j.progress)) + '%';
        }
        statusEl.textContent = `Status: ${j.status || 'unknown'} — ${j.progress ?? 0}%`;

        if (j.error) {
          err.textContent = 'Error: ' + j.error;
          return; // stop polling on error
        }

        if (j.status === 'done') {
          done.style.display = 'flex';
          dl.href = `/download/${filename}`;
          statusEl.textContent = 'Status: done — 100%';
          bar.style.width = '100%';
          return; // stop polling
        }
      } catch (e) {
        err.textContent = 'Polling error: ' + e;
      }
      setTimeout(poll, 500);
    }
    poll();
  </script>
</body>
</html>
